{% extends "base.html" %}

{% block title %}登录 - EasyAIPPT{% endblock %}

{% block content %}
<div class="container" style="max-width: 400px; margin-top: 100px;">
    <div class="card">
        <div class="text-center mb-lg">
            <h1>EasyAIPPT</h1>
            <p class="text-muted">请输入密码访问</p>
        </div>

        <form id="login-form" onsubmit="handleLogin(event)">
            <div class="mb-lg">
                <label for="password">密码</label>
                <input type="password" id="password" name="password" required autofocus>
            </div>

            <div class="text-right">
                <button type="submit" class="btn btn-primary" style="width: 100%;">登录</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>
async function handleLogin(event) {
    event.preventDefault();
    const form = event.target;
    const password = form.password.value;

    try {
        const data = await apiRequest('/api/auth/login', {
            method: 'POST',
            body: JSON.stringify({ password })
        });

        if (data.success) {
            // 登录成功，跳转到首页或之前访问的页面
            const redirectUrl = new URLSearchParams(window.location.search).get('next') || '/';
            window.location.href = redirectUrl;
        }
    } catch (error) {
        showError('密码错误');
        form.password.value = '';
        form.password.focus();
    }
}
</script>
{% endblock %}
