{% extends "base.html" %}

{% block title %}登录 - EasyAIPPT{% endblock %}

{% block content %}
<div style="min-height: 80vh; display: flex; align-items: center; justify-content: center;">
    <div style="max-width: 500px; width: 100%; padding: 0 var(--spacing-lg);">
        <div class="card" style="padding: var(--spacing-2xl);">
            <div class="text-center mb-xl">
                <h1 style="font-size: var(--font-size-3xl); margin-bottom: var(--spacing-sm);">EasyAIPPT</h1>
                <p class="text-muted">请输入密码访问</p>
            </div>

            <form id="login-form" onsubmit="handleLogin(event)">
                <div class="mb-xl">
                    <input type="password" id="password" name="password" placeholder="请输入密码" required autofocus style="padding: var(--spacing-sm) var(--spacing-md); font-size: var(--font-size-base);">
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; padding: var(--spacing-md);">登录</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>
async function handleLogin(event) {
    event.preventDefault();
    const form = event.target;
    const password = form.password.value;

    try {
        // 直接使用fetch，避免apiRequest的401自动跳转
        const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ password })
        });

        const data = await response.json();

        if (data.success) {
            // 登录成功，跳转到首页或之前访问的页面
            const redirectUrl = new URLSearchParams(window.location.search).get('next') || '/';
            window.location.href = redirectUrl;
        } else {
            // 登录失败，显示错误
            showError(data.error || '密码错误');
            form.password.value = '';
            form.password.focus();
        }
    } catch (error) {
        showError('登录失败，请重试');
        form.password.value = '';
        form.password.focus();
    }
}
</script>
{% endblock %}
