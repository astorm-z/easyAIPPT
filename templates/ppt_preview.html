{% extends "base.html" %}

{% block title %}PPT预览 - EasyAIPPT{% endblock %}

{% block nav_links %}
<a href="/" class="nav-link">返回首页</a>
<a href="/outline/{{ project_id }}" class="nav-link">编辑大纲</a>
{% endblock %}

{% block content %}
<div class="container">
    <div class="mb-xl text-center">
        <h1 id="ppt-title">PPT预览</h1>
    </div>

    <!-- 样式模板选择 -->
    <div id="style-section" class="mb-xl">
        <h3 class="mb-md">选择样式模板</h3>
        <div class="mb-lg">
            <button class="btn" onclick="generateStyles()">生成样式模板</button>
        </div>
        <div id="styles-grid" class="grid grid-3">
            <!-- 样式模板将通过JavaScript动态加载 -->
        </div>
    </div>

    <div class="divider"></div>

    <!-- PPT页面生成 -->
    <div id="pages-section">
        <div class="mb-md">
            <h3>PPT页面</h3>
            <div class="mb-lg">
                <button class="btn btn-primary" onclick="showGeneratePrompt()" id="generate-btn">开始生成</button>
                <button class="btn" onclick="resumeGeneration()" id="resume-btn" style="display: none;">继续生成</button>
                <button class="btn" onclick="downloadPPT()" id="download-btn" disabled>下载PPT</button>
            </div>
        </div>

        <!-- 进度条 -->
        <div id="progress-section" class="mb-lg hidden">
            <div class="progress">
                <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
            </div>
            <p id="progress-text" class="text-center text-muted mt-sm">准备中...</p>
        </div>

        <!-- PPT页面网格 -->
        <div id="pages-grid" class="grid grid-3">
            <!-- PPT页面将通过JavaScript动态加载 -->
        </div>
    </div>
</div>

<!-- 生成PPT提示词编辑模态框 -->
<div id="generate-ppt-prompt-modal" class="modal-overlay">
    <div class="modal" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
        <div class="modal-header">
            <button class="modal-close" onclick="hideGeneratePPTPromptModal()">&times;</button>
            <h3 class="modal-title">生成PPT提示词预览</h3>
        </div>
        <div style="padding: var(--spacing-lg);">
            <p class="text-muted text-sm mb-md">以下是将用于生成每一页PPT的提示词模板。您可以修改后再生成。</p>
            <div id="ppt-prompts-container">
                <!-- 提示词列表将通过JavaScript动态加载 -->
            </div>
        </div>
        <div style="padding: var(--spacing-lg); text-align: right; border-top: 1px solid var(--color-gray-200);">
            <button class="btn" onclick="hideGeneratePPTPromptModal()">取消</button>
            <button class="btn btn-primary" onclick="confirmStartGeneration()">确认生成</button>
        </div>
    </div>
</div>

<!-- 样式大图查看模态框 -->
<div id="style-image-modal" class="modal-overlay">
    <div class="modal" style="max-width: 95vw; max-height: 95vh;">
        <div class="modal-header">
            <button class="modal-close" onclick="closeStyleImageModal()">&times;</button>
            <h3 class="modal-title" id="style-image-title">样式预览</h3>
        </div>
        <div style="padding: var(--spacing-lg); text-align: center; max-height: 80vh; overflow: auto;">
            <img id="style-image-large" src="" alt="样式大图" style="max-width: 100%; height: auto;">
        </div>
        <div style="padding: var(--spacing-lg); text-align: center; border-top: 1px solid var(--color-gray-200);">
            <button class="btn" onclick="closeStyleImageModal()">关闭</button>
        </div>
    </div>
</div>

<!-- PPT页面大图查看模态框 -->
<div id="page-image-modal" class="modal-overlay">
    <div class="modal" style="max-width: 95vw; max-height: 95vh;">
        <div class="modal-header">
            <button class="modal-close" onclick="closePageImageModal()">&times;</button>
            <h3 class="modal-title" id="page-image-title">页面预览</h3>
        </div>
        <div style="padding: var(--spacing-lg); text-align: center; max-height: 80vh; overflow: auto;">
            <img id="page-image-large" src="" alt="页面大图" style="max-width: 100%; height: auto;">
        </div>
        <div style="padding: var(--spacing-lg); text-align: center; border-top: 1px solid var(--color-gray-200);">
            <button class="btn" onclick="closePageImageModal()">关闭</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>
    const projectId = {{ project_id }};
</script>
<script src="{{ url_for('static', filename='js/progress.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        loadProjectInfo(projectId);
        loadStyles(projectId);
        loadPages(projectId);
    });
</script>
{% endblock %}
